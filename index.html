<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Notas de Enfermer√≠a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

    <style>
        .hidden {
            display: none;
        }

        .section-active {
            display: block;
        }

        /* Animaciones suaves */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Estilos para los botones de navegaci√≥n */
        .nav-button.active {
            background-color: white;
            border-bottom: 2px solid #3B82F6;
            color: #3B82F6;
        }

        /* Estilos para mejorar la legibilidad de la nota generada */
        .nota-generada {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        /* Mejoras visuales */
        .form-section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .field-group {
            margin-bottom: 16px;
        }

        .field-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }

        .field-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .field-input:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-primary {
            background-color: #3B82F6;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary:hover {
            background-color: #2563EB;
        }

        .btn-secondary {
            background-color: #6B7280;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-secondary:hover {
            background-color: #4B5563;
        }

        .btn-success {
            background-color: #10B981;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .btn-danger {
            background-color: #EF4444;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-danger:hover {
            background-color: #DC2626;
        }

        .alert-info {
            background-color: #EBF8FF;
            border: 1px solid #BEE3F8;
            color: #2B6CB0;
            padding: 12px;
            border-radius: 6px;
            margin: 16px 0;
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #D1D5DB;
            transition: background-color 0.2s;
        }

        .progress-dot.active {
            background-color: #3B82F6;
        }

        .medicamento-item,
        .evento-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background-color: #f9fafb;
        }

        .input-error {
            border-color: #EF4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }

        @media (max-width: 768px) {
            /* Ajustes para pantallas peque√±as */

            /* Reduce paddings generales */
            .form-section {
                padding: 16px;
            }

            /* Mejora navegaci√≥n horizontal */
            .nav-button {
                flex-shrink: 0;
                font-size: 12px;
                padding: 8px 12px;
            }

            /* Reducci√≥n en tama√±os de fuente */
            h1,
            h3,
            h4 {
                font-size: 1rem;
            }

            .field-label {
                font-size: 13px;
            }

            .field-input {
                font-size: 13px;
                padding: 6px 10px;
            }

            /* Botones */
            .btn-primary,
            .btn-secondary,
            .btn-success,
            .btn-danger {
                padding: 6px 12px;
                font-size: 14px;
            }

            /* Texto de la nota generada */
            .nota-generada {
                font-size: 13px;
                padding: 12px;
            }

            /* Footer m√°s compacto */
            footer p,
            footer a {
                font-size: 12px;
            }

            /* Controla la barra inferior en m√≥viles */
            .rounded-b-lg.flex.justify-between {
                flex-direction: column;
                gap: 10px;
            }

            #btnAnterior,
            #btnSiguiente,
            #btnGenerar {
                width: 100%;
            }
        }

        .tooltip {
            position: absolute;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: #374151;
            z-index: 100;
        }

        .tooltip.hidden {
            display: none;
        }

        .field-input {
            transition: border-color 0.2s, color 0.2s;
        }

        .field-input:focus {
            outline: none;
        }
    </style>

</head>

<body class="bg-gray-50 min-h-screen">
    <div class="max-w-6xl mx-auto p-4 md:p-6">
        <div class="bg-white rounded-lg shadow-lg">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 rounded-t-lg">
                <h1 class="text-xl md:text-2xl font-bold mb-2">Generador de Notas de Enfermer√≠a</h1>
                <p class="text-blue-100 text-sm md:text-base">Plantilla universal para generar notas profesionales de
                    enfermer√≠a</p>
            </div>

            <!-- Navigation -->
            <div class="border-b bg-gray-50">
                <div class="flex overflow-x-auto">
                    <button
                        class="nav-button flex items-center gap-2 px-3 md:px-4 py-3 min-w-max text-sm font-medium border-b-2 border-transparent transition-colors hover:bg-gray-100"
                        onclick="showSection(0)">
                        <span>üë§</span> Datos del Paciente
                    </button>
                    <button
                        class="nav-button flex items-center gap-2 px-3 md:px-4 py-3 min-w-max text-sm font-medium border-b-2 border-transparent transition-colors hover:bg-gray-100"
                        onclick="showSection(1)">
                        <span>üìä</span> Signos Vitales
                    </button>
                    <button
                        class="nav-button flex items-center gap-2 px-3 md:px-4 py-3 min-w-max text-sm font-medium border-b-2 border-transparent transition-colors hover:bg-gray-100"
                        onclick="showSection(2)">
                        <span>üîç</span> Valoraci√≥n F√≠sica
                    </button>
                    <button
                        class="nav-button flex items-center gap-2 px-3 md:px-4 py-3 min-w-max text-sm font-medium border-b-2 border-transparent transition-colors hover:bg-gray-100"
                        onclick="showSection(3)">
                        <span>üìù</span> Eventos del Turno
                    </button>
                    <button
                        class="nav-button flex items-center gap-2 px-3 md:px-4 py-3 min-w-max text-sm font-medium border-b-2 border-transparent transition-colors hover:bg-gray-100"
                        onclick="generarNota()">
                        <span>üìÑ</span> Nota Generada
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="p-4 md:p-6">

                <!-- Secci√≥n 0: Datos del Paciente -->
                <div id="section-0" class="section fade-in">
                    <div class="form-section">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Informaci√≥n B√°sica del Paciente</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="field-group">
                                <label class="field-label">Iniciales del paciente * <span class="tooltip-trigger"
                                        data-tooltip="Letras que representan el nombre completo del paciente (Ej: Juan P√©rez = JP).">‚ÑπÔ∏è
                                        </sxpan></label>
                                <input type="text" id="iniciales" class="field-input" placeholder="Ej: LCL">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Edad * <span class="tooltip-trigger"
                                        data-tooltip="Edad del paciente en a√±os completos.">‚ÑπÔ∏è</span></label>
                                <input type="number" id="edad" class="field-input" placeholder="Ej: 45">
                            </div>

                            <div class="field-group">
                                <label class="field-label">G√©nero * <span class="tooltip-trigger"
                                        data-tooltip="Identidad de g√©nero del paciente seg√∫n el registro.">‚ÑπÔ∏è</span></label>
                                <select id="genero" class="field-input">
                                    <option value="masculino">Masculino</option>
                                    <option value="femenino">Femenino</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label">Alergias <span class="tooltip-trigger"
                                        data-tooltip="Sustancias o medicamentos a los que el paciente presenta reacciones adversas.">‚ÑπÔ∏è</span></label>
                                <input type="text" id="alergias" class="field-input"
                                    placeholder="Ej: esparadrapo, penicilina">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Hora de recepci√≥n * <span class="tooltip-trigger"
                                        data-tooltip="Hora en la que el paciente fue recibido en el servicio.">‚ÑπÔ∏è</span></label>
                                <input type="time" id="horaRecepcion" class="field-input">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Habitaci√≥n * <span class="tooltip-trigger"
                                        data-tooltip="N√∫mero o c√≥digo asignado al paciente en la instituci√≥n.">‚ÑπÔ∏è</span></label>
                                <input type="text" id="habitacion" class="field-input" placeholder="Ej: 204B">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Acompa√±ante <span class="tooltip-trigger"
                                        data-tooltip="Persona que permanece con el paciente durante su estancia.">‚ÑπÔ∏è</span></label>
                                <input type="text" id="acompanante" class="field-input"
                                    placeholder="Ej: hija, hermana, esposo">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Escala de Glasgow <span class="tooltip-trigger"
                                        data-tooltip="Eval√∫a el nivel de conciencia. M√°ximo: 15.">‚ÑπÔ∏è</span></label>
                                <input type="text" id="glasgow" class="field-input" value="15" placeholder="15">
                            </div>
                        </div>

                        <div class="field-group">
                            <label class="field-label">Posici√≥n <span class="tooltip-trigger"
                                    data-tooltip="Posici√≥n en la que se encuentra el paciente al ingreso.">‚ÑπÔ∏è</span></label>
                            <select id="posicion" class="field-input">
                                <option value="dec√∫bito supino">Dec√∫bito supino</option>
                                <option value="dec√∫bito lateral derecho">Dec√∫bito lateral derecho</option>
                                <option value="dec√∫bito lateral izquierdo">Dec√∫bito lateral izquierdo</option>
                                <option value="sedente">Sedente</option>
                                <option value="fowler">Fowler</option>
                                <option value="semi-fowler">Semi-fowler</option>
                            </select>
                        </div>

                        <div class="field-group">
                            <label class="flex items-center">
                                <input type="checkbox" id="barandas" class="mr-2" checked>
                                <span class="field-label mb-0">Barandas arriba <span class="tooltip-trigger"
                                        data-tooltip="Medida de seguridad para evitar ca√≠das del paciente.">‚ÑπÔ∏è</span></span>
                            </label>
                        </div>

                        <!-- Acceso Venoso -->
                        <div class="border-t pt-4 mt-4">
                            <h4 class="font-medium text-gray-800 mb-3">Acceso Venoso</h4>
                            <div class="field-group">
                                <label class="flex items-center">
                                    <input type="checkbox" id="tieneAccesoVenoso" class="mr-2"
                                        onchange="toggleAccesoVenoso()">
                                    <span class="field-label mb-0">Tiene acceso venoso</span>
                                </label>
                            </div>

                            <div id="accesoVenosoFields" class="hidden mt-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="field-group">
                                        <label class="field-label">Ubicaci√≥n del acceso</label>
                                        <input type="text" id="ubicacionAcceso" class="field-input"
                                            placeholder="Ej: vena cef√°lica, extremidad derecha">
                                    </div>
                                    <div class="field-group">
                                        <label class="field-label">Calibre del cat√©ter <span class="tooltip-trigger"
                                                data-tooltip="N√∫mero del cat√©ter: entre m√°s bajo el n√∫mero, mayor el grosor.">‚ÑπÔ∏è</span></label>
                                        <input type="text" id="calibreCateter" class="field-input"
                                            placeholder="Ej: 18, 20, 22">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Informaci√≥n M√©dica -->
                        <div class="border-t pt-4 mt-4">
                            <h4 class="font-medium text-gray-800 mb-3">Informaci√≥n M√©dica</h4>

                            <div class="field-group">
                                <label class="field-label">Diagn√≥stico Principal <span class="tooltip-trigger"
                                        data-tooltip="Motivo principal de hospitalizaci√≥n o atenci√≥n m√©dica.">‚ÑπÔ∏è</span></label>
                                <textarea id="diagnosticoPrincipal" class="field-input" rows="2"
                                    placeholder="Ej: Postoperatorio de cirug√≠a ortop√©dica de rodilla derecha"></textarea>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="field-group">
                                    <label class="field-label">Fecha de cirug√≠a <span class="tooltip-trigger"
                                            data-tooltip="Fecha en la que se realiz√≥ el procedimiento quir√∫rgico.">‚ÑπÔ∏è</span></label>
                                    <input type="date" id="fechaCirugia" class="field-input">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">Procedimientos realizados <span class="tooltip-trigger"
                                            data-tooltip="Cirug√≠as o intervenciones m√©dicas aplicadas.">‚ÑπÔ∏è</span></label>
                                    <input type="text" id="procedimientos" class="field-input"
                                        placeholder="Ej: artroscopia de rodilla">
                                </div>
                            </div>

                            <div class="field-group">
                                <label class="field-label">Antecedentes m√©dicos <span class="tooltip-trigger"
                                        data-tooltip="Condiciones de salud previas relevantes (Ej: diabetes, hipertensi√≥n).">‚ÑπÔ∏è</span></label>
                                <input type="text" id="antecedentes" class="field-input"
                                    placeholder="Ej: Diabetes tipo 2, hipertensi√≥n arterial">
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="field-group">
                                    <label class="field-label">Tipo de dieta <span class="tooltip-trigger"
                                            data-tooltip="Tipo de alimentaci√≥n indicada por el equipo m√©dico.">‚ÑπÔ∏è</span></label>
                                    <input type="text" id="tipoDieta" class="field-input"
                                        placeholder="Ej: hipogluc√≠dica e hipos√≥dica">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">Restricciones <span class="tooltip-trigger"
                                            data-tooltip="Limitaciones f√≠sicas, alimenticias u otras indicadas por el m√©dico.">‚ÑπÔ∏è</span></label>
                                    <input type="text" id="restricciones" class="field-input"
                                        placeholder="Ej: restricci√≥n de flexi√≥n de pierna">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 1: Signos Vitales -->
                <div id="section-1" class="section hidden">
                    <div class="form-section">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Signos Vitales de Ingreso</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="field-group">
                                <label class="field-label">Frecuencia Card√≠aca (lpm) <span class="tooltip-trigger"
                                        data-tooltip="Latidos por minuto. Rango normal: 60‚Äì100 lpm.">‚ÑπÔ∏è</span></label>
                                <input type="number" id="fc" class="field-input" placeholder="Ej: 60-100">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Frecuencia Respiratoria (rpm)</label>
                                <input type="number" id="fr" class="field-input" placeholder="Ej: 12-20">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Temperatura (¬∞C) <span class="tooltip-trigger"
                                        data-tooltip="Valor corporal en grados Celsius. Normal: 36.0‚Äì37.5¬∞C.">‚ÑπÔ∏è</span></label>
                                <input type="number" step="0.1" id="temperatura" class="field-input"
                                    placeholder="Ej: 36.5">
                            </div>

                            <div class="field-group">
                                <label class="field-label">SPO2 (%) <span class="tooltip-trigger"
                                        data-tooltip="Saturaci√≥n de ox√≠geno en sangre. Normal: 95‚Äì100%.">‚ÑπÔ∏è</span></label>
                                <input type="number" id="spo2" class="field-input" placeholder="Ej: 95-100">
                            </div>

                            <div class="field-group">
                                <label class="field-label">PA Sist√≥lica (mmHg) <span class="tooltip-trigger"
                                        data-tooltip="Presi√≥n m√°xima durante el latido card√≠aco.">‚ÑπÔ∏è</span></label>
                                <input type="number" id="paSistolica" class="field-input" placeholder="Ej: 120"
                                    onchange="calcularPAM()">
                            </div>

                            <div class="field-group">
                                <label class="field-label">PA Diast√≥lica (mmHg) <span class="tooltip-trigger"
                                        data-tooltip="Presi√≥n m√≠nima entre latidos del coraz√≥n.">‚ÑπÔ∏è</span></label>
                                <input type="number" id="paDiastolica" class="field-input" placeholder="Ej: 80"
                                    onchange="calcularPAM()">
                            </div>

                            <div class="field-group">
                                <label class="field-label">Glucometr√≠a (mg/dL) <span class="tooltip-trigger"
                                        data-tooltip="Nivel de glucosa en sangre. Normal: 70‚Äì100 mg/dL en ayunas.">‚ÑπÔ∏è</span></label>
                                <input type="number" id="glucometria" class="field-input" placeholder="Ej: >100">
                            </div>

                            <div class="field-group">
                                <label class="field-label">EVA - Dolor (0-10) <span class="tooltip-trigger"
                                        data-tooltip="Escala visual de dolor donde 0 es nada y 10 es el peor dolor imaginable.">‚ÑπÔ∏è</span></label>
                                <input type="number" min="0" max="10" id="eva" class="field-input" placeholder="0-10">
                            </div>
                        </div>

                        <div id="pamInfo" class="alert-info hidden" role="alert" aria-live="polite">
                            <p>PAM calculada: <span id="pamValue"></span> mmHg</p>
                        </div>

                        <!-- C√°lculo de IMC (opcional) -->
                        <div class="border-t pt-4 mt-4">
                            <h4 class="font-medium text-gray-800 mb-3">√çndice de Masa Corporal (IMC)</h4>

                            <div class="field-group">
                                <label class="flex items-center">
                                    <input type="checkbox" id="mostrarIMC" class="mr-2" onchange="toggleIMC()">
                                    <span class="field-label mb-0">¬øDesea registrar el IMC?</span>
                                </label>
                            </div>

                            <div id="seccionIMC" class="hidden">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="field-group">
                                        <label class="field-label" for="peso">Peso (kg)</label>
                                        <input type="number" id="peso" class="field-input" placeholder="Ej: 70">
                                    </div>
                                    <div class="field-group">
                                        <label class="field-label" for="talla">Talla (cm)</label>
                                        <input type="number" id="talla" class="field-input" placeholder="Ej: 170">
                                    </div>
                                    <div class="field-group flex items-end">
                                        <button onclick="calcularIMC()" class="btn-primary w-full">Calcular IMC</button>
                                    </div>
                                </div>
                                <div id="resultadoIMC" class="mt-3 text-sm text-gray-700 font-medium" role="alert"
                                    aria-live="polite"></div>
                            </div>
                        </div>


                        <!-- Signos Vitales de Entrega -->
                        <div class="border-t pt-4 mt-6">
                            <h4 class="font-medium text-gray-800 mb-4">Signos Vitales de Entrega</h4>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="field-group">
                                    <label class="field-label">FC Final (lpm)</label>
                                    <input type="number" id="fcFinal" oninput="mostrarSugerenciasEnPantalla()"
                                        class="field-input" placeholder="Ej: 60-100">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">FR Final (rpm)</label>
                                    <input type="number" id="frFinal" class="field-input" placeholder="Ej: 12-20">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">Temperatura Final (¬∞C)</label>
                                    <input type="number" step="0.1" id="temperaturaFinal"
                                        oninput="mostrarSugerenciasEnPantalla()" class="field-input"
                                        placeholder="Ej: 36.5">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">SPO2 Final (%)</label>
                                    <input type="number" id="spo2Final" class="field-input"
                                        oninput="mostrarSugerenciasEnPantalla()" placeholder="Ej: 95-100">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">PA Sist√≥lica Final</label>
                                    <input type="number" id="paSistolicaFinal" class="field-input"
                                        oninput="mostrarSugerenciasEnPantalla()" placeholder="Ej: 120"
                                        onchange="calcularPAMFinal()">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">PA Diast√≥lica Final</label>
                                    <input type="number" id="paDiastolicaFinal" oninput="mostrarSugerenciasEnPantalla()"
                                        class="field-input" placeholder="Ej: 80" onchange="calcularPAMFinal()">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">Glucometr√≠a Final</label>
                                    <input type="number" id="glucometriaFinal" oninput="mostrarSugerenciasEnPantalla()"
                                        class="field-input" placeholder="Ej: >100">
                                </div>

                                <div class="field-group">
                                    <label class="field-label">EVA Final</label>
                                    <input type="number" min="0" max="10" id="evaFinal"
                                        oninput="mostrarSugerenciasEnPantalla()" class="field-input" placeholder="0-10">
                                </div>
                            </div>

                            <div id="pamFinalInfo" class="alert-info hidden">
                                <p>PAM final calculada: <span id="pamFinalValue"></span> mmHg</p>
                            </div>

                            <div id="sugerenciasInfo" class="alert-info hidden mt-3">
                                <p class="font-bold">Sugerencias cl√≠nicas:</p>
                                <ul id="sugerenciasLista" class="list-disc list-inside text-sm text-gray-800"></ul>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 2: Valoraci√≥n F√≠sica -->
                <div id="section-2" class="section hidden">
                    <div class="form-section">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Valoraci√≥n F√≠sica y Cuidados</h3>

                        <!-- Examen F√≠sico -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="field-group">
                                <label class="field-label">Pupilas <span class="tooltip-trigger"
                                        data-tooltip="Observaci√≥n del tama√±o y respuesta de las pupilas a la luz.">‚ÑπÔ∏è</span></label>
                                <select id="pupilas" class="field-input">
                                    <option value="isoc√≥ricas y reactivas">Isoc√≥ricas y reactivas</option>
                                    <option value="isoc√≥ricas">Isoc√≥ricas</option>
                                    <option value="anisoc√≥ricas">Anisoc√≥ricas</option>
                                    <option value="midri√°ticas">Midri√°ticas</option>
                                    <option value="mi√≥ticas">Mi√≥ticas</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label">Mucosas <span class="tooltip-trigger"
                                        data-tooltip="Aspecto de las mucosas orales: color, hidrataci√≥n.">‚ÑπÔ∏è</span></label>
                                <select id="mucosas" class="field-input">
                                    <option value="h√∫medas y rosadas">H√∫medas y rosadas</option>
                                    <option value="h√∫medas sin lesiones">H√∫medas sin lesiones</option>
                                    <option value="secas">Secas</option>
                                    <option value="p√°lidas">P√°lidas</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label">Ruidos card√≠acos <span class="tooltip-trigger"
                                        data-tooltip="Sonidos generados por el coraz√≥n al latir.">‚ÑπÔ∏è</span></label>
                                <select id="ruidosCardiacos" class="field-input">
                                    <option value="r√≠tmicos, sin soplos">R√≠tmicos, sin soplos</option>
                                    <option value="arr√≠tmicos, sin soplos">Arr√≠tmicos, sin soplos</option>
                                    <option value="r√≠tmicos, con soplos">R√≠tmicos, con soplos</option>
                                    <option value="taquic√°rdicos">Taquic√°rdicos</option>
                                    <option value="bradic√°rdicos">Bradic√°rdicos</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label">Ruidos pulmonares <span class="tooltip-trigger"
                                        data-tooltip="Sonidos que se escuchan al auscultar los pulmones.">‚ÑπÔ∏è</span></label>
                                <select id="ruidosPulmonares" class="field-input">
                                    <option value="normales en ambos campos">Normales en ambos campos</option>
                                    <option value="normales">Normales</option>
                                    <option value="disminuidos">Disminuidos</option>
                                    <option value="con estertores">Con estertores</option>
                                    <option value="con sibilancias">Con sibilancias</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label">Abdomen <span class="tooltip-trigger"
                                        data-tooltip="Estado f√≠sico del abdomen: blando, distendido, doloroso, etc.">‚ÑπÔ∏è</span></label>
                                <select id="abdomen" class="field-input">
                                    <option value="blando, depresible, sin dolor">Blando, depresible, sin dolor</option>
                                    <option value="sin distensi√≥n">Sin distensi√≥n</option>
                                    <option value="distendido">Distendido</option>
                                    <option value="doloroso a la palpaci√≥n">Doloroso a la palpaci√≥n</option>
                                </select>
                            </div>

                            <div class="field-group">
                                <label class="field-label">Llenado capilar <span class="tooltip-trigger"
                                        data-tooltip="Tiempo que tarda la sangre en retornar al presionar una u√±a. Normal: < 2 segundos.">‚ÑπÔ∏è</span></label>
                                <select id="llenadoCapilar" class="field-input">
                                    <option value="< 2 segundos">
                                        < 2 segundos</option>
                                    <option value="< 3 segundos">
                                        < 3 segundos</option>
                                    <option value="> 3 segundos">> 3 segundos</option>
                                </select>
                            </div>
                        </div>

                        <!-- Evaluaci√≥n Nutricional -->
                        <div class="field-group mb-6">
                            <label class="field-label">Evaluaci√≥n nutricional</label>
                            <textarea id="evaluacionNutricional" class="field-input" rows="3"
                                placeholder="Ej: la paciente refiere alimentaci√≥n adecuada, presenta buen estado nutricional..."></textarea>
                        </div>

                        <!-- Terapia F√≠sica -->
                        <div class="border-t pt-4 mb-6">
                            <h4 class="font-medium text-gray-800 mb-3">Terapia F√≠sica</h4>
                            <div class="field-group">
                                <label class="flex items-center">
                                    <input type="checkbox" id="terapiaFisica" class="mr-2"
                                        onchange="toggleTerapiaFisica()">
                                    <span class="field-label mb-0">Se realiz√≥ terapia f√≠sica</span>
                                </label>
                            </div>

                            <div id="terapiaFisicaFields" class="hidden mt-3">
                                <div class="field-group">
                                    <label class="field-label">Detalles de la terapia</label>
                                    <textarea id="detallesTerapia" class="field-input" rows="3"
                                        placeholder="Ej: se asiste al paciente para deambulaci√≥n, realizando ejercicios de flexi√≥n..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="border-t pt-4 mt-4">
                            <h4 class="font-medium text-gray-800 mb-3">Control de L√≠quidos</h4>
                            <div class="field-group">
                                <label class="flex items-center">
                                    <input type="checkbox" id="realizarControlLiquidos" class="mr-2"
                                        onchange="toggleControlLiquidos()">
                                    <span class="field-label mb-0">¬øSe realiz√≥ control de l√≠quidos?</span>
                                </label>
                            </div>

                            <div id="controlLiquidosFields" class="hidden mt-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="field-group">
                                        <label class="field-label">L√≠quidos Administrados (mL)</label>
                                        <input type="number" id="liquidosAdministrados" class="field-input"
                                            placeholder="Ej: 1500" min="0">
                                    </div>
                                    <div class="field-group">
                                        <label class="field-label">L√≠quidos Eliminados (mL)</label>
                                        <input type="number" id="liquidosEliminados" class="field-input"
                                            placeholder="Ej: 1200" min="0">
                                    </div>
                                </div>

                                <div class="field-group mt-3 relative">
                                    <label class="field-label">
                                        Balance H√≠drico (mL)
                                        <span class="tooltip-trigger"
                                            data-tooltip="El balance h√≠drico es la diferencia entre l√≠quidos administrados y eliminados. Valores positivos indican exceso, negativos indican d√©ficit.">‚ÑπÔ∏è</span>
                                    </label>
                                    <input type="text" id="balanceHidrico" class="field-input bg-gray-200" readonly>
                                </div>

                            </div>
                        </div>

                        <!-- Medicamentos -->
                        <div class="border-t pt-4">
                            <h4 class="font-medium text-gray-800 mb-3">Medicamentos Administrados</h4>
                            <button onclick="agregarMedicamento()" class="btn-success mb-4">+ Agregar
                                Medicamento</button>

                            <div id="medicamentosContainer">
                                <!-- Los medicamentos se agregar√°n din√°micamente aqu√≠ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 3: Eventos del Turno -->
                <div id="section-3" class="section hidden">
                    <div class="form-section">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Eventos del Turno</h3>

                        <button onclick="agregarEvento()" class="btn-primary mb-4">+ Agregar Evento</button>

                        <div id="eventosContainer" class="mb-6">
                            <!-- Los eventos se agregar√°n din√°micamente aqu√≠ -->
                        </div>

                        <div class="border-t pt-4">
                            <h4 class="font-medium text-gray-800 mb-3">Observaciones Adicionales</h4>
                            <div class="field-group">
                                <label class="field-label">Observaciones generales</label>
                                <textarea id="observaciones" class="field-input" rows="4"
                                    placeholder="Observaciones generales, recomendaciones especiales, estado general del paciente..."></textarea>
                                    <button type="button" onclick="iniciarDictadoEnTextarea(this)" class="btn-primary mt-1">
                                        üé§ Dictar Texto
                                      </button>
                                      
                            </div>
                        </div>
                        <button onclick="generarNota()" class="btn-secondary mb-4">
                            üëÅ Ver vista previa
                        </button>
                        <div class="bg-green-50 border border-green-200 p-4 rounded-md mt-6">
                            <p class="text-green-800 font-medium mb-2">¬°Listo para generar la nota!</p>
                            <p class="text-green-700 text-sm">
                                Has completado la informaci√≥n necesaria. Haz clic en "Generar Nota" para crear tu nota
                                de enfermer√≠a profesional.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 4: Nota Generada -->
                <div id="section-4" class="section hidden">
                    <div class="form-section">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Nota de Enfermer√≠a Generada</h3>

                        <div id="notaGenerada" class="nota-generada mb-4">
                            <!-- La nota generada aparecer√° aqu√≠ -->
                        </div>

                        <div class="flex flex-wrap gap-3">
                            <button onclick="copiarNota()" class="btn-primary">
                                üìã Copiar al Portapapeles
                            </button>

                            <button onclick="descargarNota()" class="btn-success">
                                üíæ Descargar como TXT
                            </button>

                            <button onclick="exportarComoPDF()" class="btn-success">
                                üìÑ Exportar como PDF
                            </button>

                            <button onclick="exportarComoXLSXBonito()" class="btn-success">
                                üìä Exportar Excel (.xlsx)
                            </button>



                        </div>
                    </div>
                </div>

            </div>

            <!-- Footer Navigation -->
            <div class="bg-gray-50 px-4 md:px-6 py-4 rounded-b-lg flex justify-between items-center border-t">
                <button id="btnAnterior" onclick="anteriorSeccion()" class="btn-secondary" disabled>
                    ‚Üê Anterior
                </button>

                <div class="w-full max-w-md mx-auto bg-gray-200 rounded-full h-2.5 overflow-hidden">
                    <div id="progressBar" class="bg-blue-500 h-2.5 transition-all duration-300" style="width: 20%;">
                    </div>
                </div>


                <button id="btnSiguiente" onclick="siguienteSeccion()" class="btn-primary">
                    Siguiente ‚Üí
                </button>

                <button id="btnGenerar" onclick="generarNota()" class="btn-success hidden">
                    üìÑ Generar Nota
                </button>
            </div>
        </div>
    </div>

    <button id="scrollTopBtn" aria-label="Volver arriba" onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
        class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg z-50 hidden">
        ‚¨ÜÔ∏è
    </button>

    <!-- Footer con estilo bonito -->
    <footer class="mt-10 border-t border-gray-200 bg-gradient-to-r from-blue-50 via-white to-blue-50 text-center py-6">
        <p class="text-gray-600 text-sm md:text-base">
            Hecho con
            <span class="inline-block animate-pulse text-red-500">‚ù§</span>
            por <span class="font-semibold text-blue-700">Tomas Arciniegas Quintero</span>
        </p>
        <a href="https://linktr.ee/Tomas_arciniegas" target="_blank"
            class="text-blue-500 hover:underline text-xs md:text-sm">
            Visita mi portafolio
        </a>
        <p class="text-gray-400 text-xs">
            <strong>Atajos de teclado:</strong><br>
            <span class="block">üî¢ <kbd>Alt</kbd> + <kbd>1</kbd> a <kbd>5</kbd> ‚Äî Navegar entre secciones</span>
            <span class="block">üìù <kbd>Alt</kbd> + <kbd>G</kbd> ‚Äî Generar nota</span>
            <span class="block">üìÑ <kbd>Alt</kbd> + <kbd>E</kbd> ‚Äî Exportar como Excel</span>
            <span class="block">üìã <kbd>Alt</kbd> + <kbd>M</kbd> ‚Äî Copiar al portapapeles</span>
        </p>

    </footer>

    <script>
        let currentSection = 0;
        let medicamentosCount = 0;
        let eventosCount = 0;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function () {
            showSection(0);
            // Establecer fecha actual por defecto
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fechaCirugia').value = today;

            // Establecer hora actual por defecto
            const now = new Date();
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' +
                now.getMinutes().toString().padStart(2, '0');
            document.getElementById('horaRecepcion').value = currentTime;
        });

        // Navegaci√≥n entre secciones
        function showSection(sectionIndex) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
                section.classList.remove('section-active');
            });

            // Mostrar la secci√≥n seleccionada
            const selectedSection = document.getElementById(`section-${sectionIndex}`);
            selectedSection.classList.remove('hidden');
            selectedSection.classList.add('section-active', 'fade-in');

            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-button').forEach((btn, index) => {
                btn.classList.remove('active');
                if (index === sectionIndex) {
                    btn.classList.add('active');
                }
            });

            // Actualizar indicadores de progreso
            document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                dot.classList.remove('active');
                if (index <= sectionIndex) {
                    dot.classList.add('active');
                }
            });

            currentSection = sectionIndex;
            updateNavigationButtons();
            actualizarBarraProgreso();
        }

        function actualizarBarraProgreso() {
            const porcentaje = (currentSection + 1) * 20;
            document.getElementById('progressBar').style.width = `${porcentaje}%`;
        }


        function updateNavigationButtons() {
            const btnAnterior = document.getElementById('btnAnterior');
            const btnSiguiente = document.getElementById('btnSiguiente');
            const btnGenerar = document.getElementById('btnGenerar');

            btnAnterior.disabled = currentSection === 0;

            if (currentSection === 4) {
                btnSiguiente.classList.add('hidden');
                btnGenerar.classList.add('hidden'); // La nota ya est√° generada en secci√≥n 4
            } else if (currentSection === 3) {
                btnSiguiente.classList.add('hidden');
                btnGenerar.classList.remove('hidden');
            } else {
                btnSiguiente.classList.remove('hidden');
                btnGenerar.classList.add('hidden');
            }
        }

        function anteriorSeccion() {
            if (currentSection > 0) {
                showSection(currentSection - 1);
            }
        }

        function siguienteSeccion() {
            if (currentSection < 4) {
                showSection(currentSection + 1);
            }
        }

        // Funciones para toggles
        function toggleAccesoVenoso() {
            const checkbox = document.getElementById('tieneAccesoVenoso');
            const fields = document.getElementById('accesoVenosoFields');

            if (checkbox.checked) {
                fields.classList.remove('hidden');
            } else {
                fields.classList.add('hidden');
            }
        }

        function toggleTerapiaFisica() {
            const checkbox = document.getElementById('terapiaFisica');
            const fields = document.getElementById('terapiaFisicaFields');

            if (checkbox.checked) {
                fields.classList.remove('hidden');
            } else {
                fields.classList.add('hidden');
            }
        }

        // C√°lculo de PAM
        function calcularPAM() {
            const sistolica = parseFloat(document.getElementById('paSistolica').value);
            const diastolica = parseFloat(document.getElementById('paDiastolica').value);

            if (sistolica && diastolica) {
                const pam = Math.round(diastolica + (sistolica - diastolica) / 3);
                document.getElementById('pamValue').textContent = pam;
                document.getElementById('pamInfo').classList.remove('hidden');
            } else {
                document.getElementById('pamInfo').classList.add('hidden');
            }
            calcularPAM();
            evaluarEstabilidadHemodinamica();
        }

        function calcularPAMFinal() {
            const sistolica = parseFloat(document.getElementById('paSistolicaFinal').value);
            const diastolica = parseFloat(document.getElementById('paDiastolicaFinal').value);

            if (sistolica && diastolica) {
                const pam = Math.round(diastolica + (sistolica - diastolica) / 3);
                document.getElementById('pamFinalValue').textContent = pam;
                document.getElementById('pamFinalInfo').classList.remove('hidden');
            } else {
                document.getElementById('pamFinalInfo').classList.add('hidden');
            }
        }

        // Gesti√≥n de medicamentos
        function agregarMedicamento() {
            medicamentosCount++;
            const container = document.getElementById('medicamentosContainer');

            const medicamentoDiv = document.createElement('div');
            medicamentoDiv.className = 'medicamento-item';
            medicamentoDiv.id = `medicamento-${medicamentosCount}`;

            medicamentoDiv.innerHTML = `
    <div class="flex justify-between items-center mb-3">
        <h5 class="font-medium text-gray-700">Medicamento ${medicamentosCount}</h5>
        <button onclick="eliminarMedicamento(${medicamentosCount})" class="btn-danger">
            üóëÔ∏è Eliminar
        </button>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="field-group">
            <label class="field-label">Nombre del medicamento <span class="tooltip-trigger" data-tooltip="Nombre gen√©rico o comercial del f√°rmaco administrado.">‚ÑπÔ∏è</span></label>
            <input type="text" id="nombreMed-${medicamentosCount}" class="field-input" placeholder="Ej: tramadol">
        </div>
        
        <div class="field-group">
            <label class="field-label">Dosis</label>
            <input type="text" id="dosisMed-${medicamentosCount}" class="field-input" placeholder="Ej: 50 mg">
        </div>
        
        <div class="field-group">
            <label class="field-label">V√≠a de administraci√≥n <span class="tooltip-trigger" data-tooltip="Ruta por la cual se administr√≥ el medicamento (IV, IM, VO, etc.).">‚ÑπÔ∏è</span></label>
            <select id="viaMed-${medicamentosCount}" class="field-input">
                <option value="IV">Intravenosa (IV)</option>
                <option value="IM">Intramuscular (IM)</option>
                <option value="SC">Subcut√°nea (SC)</option>
                <option value="VO">V√≠a oral (VO)</option>
                <option value="SL">Sublingual (SL)</option>
                <option value="t√≥pica">T√≥pica</option>
            </select>
        </div>
        
        <div class="field-group">
            <label class="field-label">Hora de administraci√≥n <span class="tooltip-trigger" data-tooltip="Hora exacta en que se aplic√≥ el medicamento.">‚ÑπÔ∏è</span></label>
            <input type="time" id="horaMed-${medicamentosCount}" class="field-input">
        </div>
    </div>
    
    <div class="field-group">
        <label class="field-label">Observaciones del medicamento <span class="tooltip-trigger" data-tooltip="Efectos observados o reacciones tras la administraci√≥n.">‚ÑπÔ∏è</span></label>
        <textarea id="obseMed-${medicamentosCount}" class="field-input" rows="2" placeholder="Efectos observados, reacciones, etc."></textarea>
    </div>
    `;

            container.appendChild(medicamentoDiv);

            // Inicializar tooltips en los nuevos elementos
            inicializarTooltips();
        }


        function eliminarMedicamento(id) {
            const medicamento = document.getElementById(`medicamento-${id}`);
            if (medicamento) {
                medicamento.remove();
            }
        }

        // Gesti√≥n de eventos
        function agregarEvento() {
            eventosCount++;
            const container = document.getElementById('eventosContainer');

            const eventoDiv = document.createElement('div');
            eventoDiv.className = 'evento-item';
            eventoDiv.id = `evento-${eventosCount}`;

            eventoDiv.innerHTML = `
        <div class="flex justify-between items-center mb-3">
            <h5 class="font-medium text-gray-700">Evento ${eventosCount}</h5>
            <button onclick="eliminarEvento(${eventosCount})" class="btn-danger">
                üóëÔ∏è Eliminar
            </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="field-group">
                <label class="field-label">Hora del evento</label>
                <input type="time" id="horaEvento-${eventosCount}" class="field-input">
            </div>
            
            <div class="field-group">
                <label class="field-label">Tipo de evento 
                    <span class="tooltip-trigger" data-tooltip="Categor√≠a del procedimiento o acci√≥n realizada.">‚ÑπÔ∏è</span>
                </label>
                <select id="tipoEvento-${eventosCount}" class="field-input">
                    <option value="administraci√≥n de medicamento">Administraci√≥n de medicamento</option>
                    <option value="toma de signos vitales">Toma de signos vitales</option>
                    <option value="curaciones">Curaciones</option>
                    <option value="movilizaci√≥n">Movilizaci√≥n</option>
                    <option value="alimentaci√≥n">Alimentaci√≥n</option>
                    <option value="higiene">Higiene</option>
                    <option value="procedimiento">Procedimiento</option>
                    <option value="interconsulta">Interconsulta</option>
                    <option value="visita m√©dica">Visita m√©dica</option>
                    <option value="otro">Otro</option>
                </select>
            </div>
        </div>
        
        <div class="field-group">
            <label class="field-label">Descripci√≥n del evento 
                <span class="tooltip-trigger" data-tooltip="Detalles sobre lo realizado, c√≥mo y cu√°ndo.">‚ÑπÔ∏è</span>
            </label>
            <textarea id="descripcionEvento-${eventosCount}" class="field-input" rows="3" placeholder="Describe detalladamente lo ocurrido durante este evento..."></textarea>
            <button type="button" onclick="iniciarDictadoEnTextarea(this)" class="btn-primary mt-1">
            üé§ Dictar Texto
            </button>
        </div>
    `;

            container.appendChild(eventoDiv);

            // Inicializar tooltips en los nuevos elementos
            inicializarTooltips();
        }


        function eliminarEvento(id) {
            const evento = document.getElementById(`evento-${id}`);
            if (evento) {
                evento.remove();
            }
        }

        // Generaci√≥n de la nota
        function generarNota() {
            // Evaluar estabilidad antes de generar la nota
            evaluarEstabilidadHemodinamica();

            // Recopilar todos los datos
            const datos = recopilarDatos();

            // Verifica campos obligatorios
            ['iniciales', 'edad', 'habitacion'].forEach(id => {
                document.getElementById(id).classList.remove('input-error');
            });

            let camposInvalidos = [];
            if (!datos.iniciales) camposInvalidos.push('iniciales');
            if (!datos.edad) camposInvalidos.push('edad');
            if (!datos.habitacion) camposInvalidos.push('habitacion');

            if (camposInvalidos.length > 0) {
                camposInvalidos.forEach(id => document.getElementById(id).classList.add('input-error'));
                alert('Por favor, completa los campos obligatorios: iniciales, edad y habitaci√≥n.');
                return;
            }

            // Generar la nota
            const nota = construirNota(datos);

            // Mostrar la nota generada
            document.getElementById('notaGenerada').textContent = nota;

            // Ir a la secci√≥n de la nota generada
            showSection(4);
        }



        function recopilarDatos() {
            const datos = {};

            // Datos b√°sicos
            datos.iniciales = document.getElementById('iniciales').value;
            datos.edad = document.getElementById('edad').value;
            datos.genero = document.getElementById('genero').value;
            datos.alergias = document.getElementById('alergias').value;
            datos.horaRecepcion = document.getElementById('horaRecepcion').value;
            datos.habitacion = document.getElementById('habitacion').value;
            datos.acompanante = document.getElementById('acompanante').value;
            datos.glasgow = document.getElementById('glasgow').value;
            datos.posicion = document.getElementById('posicion').value;
            datos.barandas = document.getElementById('barandas').checked;

            // control liquidos
            datos.realizarControlLiquidos = document.getElementById('realizarControlLiquidos').checked;

            if (datos.realizarControlLiquidos) {
                datos.liquidosAdministrados = parseFloat(document.getElementById('liquidosAdministrados').value) || 0;
                datos.liquidosEliminados = parseFloat(document.getElementById('liquidosEliminados').value) || 0;
                datos.balanceHidrico = parseFloat(document.getElementById('balanceHidrico').value) || 0;
            } else {
                datos.liquidosAdministrados = 0;
                datos.liquidosEliminados = 0;
                datos.balanceHidrico = null;
            }

            // Acceso venoso
            datos.tieneAccesoVenoso = document.getElementById('tieneAccesoVenoso').checked;
            datos.ubicacionAcceso = document.getElementById('ubicacionAcceso').value;
            datos.calibreCateter = document.getElementById('calibreCateter').value;

            // Informaci√≥n m√©dica
            datos.diagnosticoPrincipal = document.getElementById('diagnosticoPrincipal').value;
            datos.fechaCirugia = document.getElementById('fechaCirugia').value;
            datos.procedimientos = document.getElementById('procedimientos').value;
            datos.antecedentes = document.getElementById('antecedentes').value;
            datos.tipoDieta = document.getElementById('tipoDieta').value;
            datos.restricciones = document.getElementById('restricciones').value;

            // Signos vitales iniciales
            datos.fc = document.getElementById('fc').value;
            datos.fr = document.getElementById('fr').value;
            datos.temperatura = document.getElementById('temperatura').value;
            datos.spo2 = document.getElementById('spo2').value;
            datos.paSistolica = document.getElementById('paSistolica').value;
            datos.paDiastolica = document.getElementById('paDiastolica').value;
            datos.glucometria = document.getElementById('glucometria').value;
            datos.eva = document.getElementById('eva').value;

            // Signos vitales finales
            datos.fcFinal = document.getElementById('fcFinal').value;
            datos.frFinal = document.getElementById('frFinal').value;
            datos.temperaturaFinal = document.getElementById('temperaturaFinal').value;
            datos.spo2Final = document.getElementById('spo2Final').value;
            datos.paSistolicaFinal = document.getElementById('paSistolicaFinal').value;
            datos.paDiastolicaFinal = document.getElementById('paDiastolicaFinal').value;
            datos.glucometriaFinal = document.getElementById('glucometriaFinal').value;
            datos.evaFinal = document.getElementById('evaFinal').value;

            // Examen f√≠sico
            datos.pupilas = document.getElementById('pupilas').value;
            datos.mucosas = document.getElementById('mucosas').value;
            datos.ruidosCardiacos = document.getElementById('ruidosCardiacos').value;
            datos.ruidosPulmonares = document.getElementById('ruidosPulmonares').value;
            datos.abdomen = document.getElementById('abdomen').value;
            datos.llenadoCapilar = document.getElementById('llenadoCapilar').value;
            datos.evaluacionNutricional = document.getElementById('evaluacionNutricional').value;

            // Terapia f√≠sica
            datos.terapiaFisica = document.getElementById('terapiaFisica').checked;
            datos.detallesTerapia = document.getElementById('detallesTerapia').value;

            // Medicamentos
            datos.medicamentos = [];
            document.querySelectorAll('.medicamento-item').forEach((item, index) => {
                const id = item.id.split('-')[1];
                const medicamento = {
                    nombre: document.getElementById(`nombreMed-${id}`)?.value || '',
                    dosis: document.getElementById(`dosisMed-${id}`)?.value || '',
                    via: document.getElementById(`viaMed-${id}`)?.value || '',
                    hora: document.getElementById(`horaMed-${id}`)?.value || '',
                    observaciones: document.getElementById(`obseMed-${id}`)?.value || ''
                };
                if (medicamento.nombre) {
                    datos.medicamentos.push(medicamento);
                }
            });

            // Eventos
            datos.eventos = [];
            document.querySelectorAll('.evento-item').forEach((item, index) => {
                const id = item.id.split('-')[1];
                const evento = {
                    hora: document.getElementById(`horaEvento-${id}`)?.value || '',
                    tipo: document.getElementById(`tipoEvento-${id}`)?.value || '',
                    descripcion: document.getElementById(`descripcionEvento-${id}`)?.value || ''
                };
                if (evento.descripcion) {
                    datos.eventos.push(evento);
                }
            });

            datos.observaciones = document.getElementById('observaciones').value;

            // datos imc
            datos.imc = {
                peso: document.getElementById("peso")?.value || '',
                talla: document.getElementById("talla")?.value || '',
                resultado: document.getElementById("resultadoIMC")?.textContent || ''
            };

            return datos;
        }

        function construirNota(datos) {
            const fecha = new Date().toLocaleDateString('es-ES');
            const hora = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });

            let nota = `NOTA DE ENFERMER√çA\n`;
            nota += `Fecha: ${fecha} - Hora: ${hora}\n\n`;

            // P√°rrafo de identificaci√≥n del paciente
            nota += `Se recibe en el servicio a paciente de iniciales ${datos.iniciales}, de ${datos.edad} a√±os de edad, g√©nero ${datos.genero}`;
            if (datos.acompanante) {
                nota += `, quien se encuentra acompa√±ado(a) por su ${datos.acompanante}`;
            }
            nota += `, asignado(a) a la habitaci√≥n ${datos.habitacion} a las ${datos.horaRecepcion} horas`;
            if (datos.alergias) {
                nota += `. El paciente presenta alergia conocida a ${datos.alergias}`;
            }
            nota += `.\n\n`;

            // Informaci√≥n m√©dica y diagn√≥stico
            if (datos.diagnosticoPrincipal) {
                nota += `El diagn√≥stico principal corresponde a ${datos.diagnosticoPrincipal}`;
                if (datos.fechaCirugia && datos.procedimientos) {
                    const fechaCirugia = new Date(datos.fechaCirugia).toLocaleDateString('es-ES');
                    nota += `, habiendo sido sometido(a) a ${datos.procedimientos} el d√≠a ${fechaCirugia}`;
                }
                nota += `. `;
            }

            if (datos.antecedentes) {
                nota += `Entre sus antecedentes m√©dicos de importancia se registra: ${datos.antecedentes}. `;
            }

            if (datos.tipoDieta) {
                nota += `Se encuentra con indicaci√≥n de dieta ${datos.tipoDieta}`;
                if (datos.restricciones) {
                    nota += ` y restricciones de ${datos.restricciones}`;
                }
                nota += `. `;
            }
            nota += `\n\n`;

            // Valoraci√≥n f√≠sica y signos vitales de ingreso
            nota += `Al ingreso, el paciente se encuentra en posici√≥n ${datos.posicion}`;
            if (datos.barandas) {
                nota += ` con barandas arriba por seguridad`;
            } else { nota += ` con barandas abajo`; }
            nota += `. Presenta una escala de Glasgow de ${datos.glasgow || '15'} puntos, pupilas ${datos.pupilas}, mucosas ${datos.mucosas}. `;

            nota += `A la auscultaci√≥n se evidencian ruidos card√≠acos ${datos.ruidosCardiacos} y ruidos pulmonares ${datos.ruidosPulmonares}. `;
            nota += `El abdomen se palpa ${datos.abdomen} y presenta un llenado capilar ${datos.llenadoCapilar}. `;

            if (datos.tieneAccesoVenoso) {
                nota += `Cuenta con acceso venoso permeable en ${datos.ubicacionAcceso || 'extremidad'}`;
                if (datos.calibreCateter) {
                    nota += ` con cat√©ter n√∫mero ${datos.calibreCateter}`;
                }
                nota += `. `;
            } else { nota += ` no cuenta con acceso venoso`; }

            // Signos vitales de ingreso en formato narrativo
            if (datos.fc || datos.fr || datos.temperatura || datos.spo2 || datos.paSistolica || datos.glucometria || datos.eva) {
                nota += `Los signos vitales de ingreso registran: `;
                let signos = [];
                if (datos.fc) signos.push(`frecuencia card√≠aca de ${datos.fc} latidos por minuto`);
                if (datos.fr) signos.push(`frecuencia respiratoria de ${datos.fr} respiraciones por minuto`);
                if (datos.temperatura) signos.push(`temperatura corporal de ${datos.temperatura}¬∞C`);
                if (datos.spo2) signos.push(`saturaci√≥n de ox√≠geno del ${datos.spo2}%`);
                if (datos.paSistolica && datos.paDiastolica) signos.push(`presi√≥n arterial de ${datos.paSistolica}/${datos.paDiastolica} mmHg`);
                if (datos.glucometria) signos.push(`glucometr√≠a de ${datos.glucometria} mg/dL`);
                if (datos.eva) signos.push(`escala an√°loga visual para dolor de ${datos.eva}/10`);

                nota += signos.join(', ') + `. `;
            }
            nota += `\n\n`;

            // Evaluaci√≥n nutricional
            if (datos.evaluacionNutricional) {
                nota += `En cuanto a la evaluaci√≥n nutricional, ${datos.evaluacionNutricional}. `;
            }
            // Mostrar IMC si fue registrado
            if (datos.imc && datos.imc.resultado) {
                nota += `Se registr√≥ un √çndice de Masa Corporal (IMC) con los siguientes datos: peso de ${datos.imc.peso} kg, talla de ${datos.imc.talla} cm. Resultado: ${datos.imc.resultado}. `;
            }

            // Medicamentos y eventos del turno en formato narrativo
            if (datos.medicamentos.length > 0 || datos.eventos.length > 0) {
                nota += `Durante el turno se realizaron las siguientes intervenciones: `;

                // Combinar medicamentos y eventos y ordenar por hora
                let intervenciones = [];

                datos.medicamentos.forEach(med => {
                    let intervencion = `se administr√≥ ${med.nombre} ${med.dosis} v√≠a ${med.via}`;
                    if (med.hora) intervencion += ` a las ${med.hora} horas`;
                    if (med.observaciones && med.observaciones.toLowerCase() !== 'ninguno' && med.observaciones.toLowerCase() !== 'ninguna') {
                        intervencion += ` (${med.observaciones})`;
                    }
                    intervenciones.push({ hora: med.hora || '', texto: intervencion });
                });

                datos.eventos.forEach(evento => {
                    let intervencion = `se realiz√≥ ${evento.tipo}: ${evento.descripcion}`;
                    if (evento.hora) intervencion += ` a las ${evento.hora} horas`;
                    intervenciones.push({ hora: evento.hora || '', texto: intervencion });
                });

                // Ordenar intervenciones por hora
                intervenciones.sort((a, b) => a.hora.localeCompare(b.hora));

                if (intervenciones.length > 0) {
                    nota += intervenciones.map(i => i.texto).join('; ') + `. `;
                }
            }

            // Terapia f√≠sica
            if (datos.terapiaFisica && datos.detallesTerapia) {
                nota += `Se implement√≥ terapia f√≠sica donde ${datos.detallesTerapia}. `;
            }

            nota += `\n\n`;

            // Terapia f√≠sica
            if (datos.realizarControlLiquidos) {
                nota += `Ademas se realiz√≥ un control de l√≠quidos durante el turno, con un ingreso total de ${datos.liquidosAdministrados} mL `;
                nota += `y una eliminaci√≥n de ${datos.liquidosEliminados} mL. El balance h√≠drico fue de ${datos.balanceHidrico} mL. `;
            } else {
                nota += `En el turno no se realiz√≥ control de l√≠quidos. `;
            }


            // Signos vitales de entrega
            if (datos.fcFinal || datos.frFinal || datos.temperaturaFinal || datos.spo2Final ||
                datos.paSistolicaFinal || datos.paDiastolicaFinal || datos.glucometriaFinal || datos.evaFinal) {

                nota += `Al momento de la entrega del turno, el paciente presenta signos vitales de: `;
                let signosFinales = [];
                if (datos.fcFinal) signosFinales.push(`frecuencia card√≠aca de ${datos.fcFinal} latidos por minuto`);
                if (datos.frFinal) signosFinales.push(`frecuencia respiratoria de ${datos.frFinal} respiraciones por minuto`);
                if (datos.temperaturaFinal) signosFinales.push(`temperatura de ${datos.temperaturaFinal}¬∞C`);
                if (datos.spo2Final) signosFinales.push(`saturaci√≥n de ox√≠geno del ${datos.spo2Final}%`);
                if (datos.paSistolicaFinal && datos.paDiastolicaFinal) signosFinales.push(`presi√≥n arterial de ${datos.paSistolicaFinal}/${datos.paDiastolicaFinal} mmHg`);
                if (datos.glucometriaFinal) signosFinales.push(`glucometr√≠a de ${datos.glucometriaFinal} mg/dL`);
                if (datos.evaFinal) signosFinales.push(`dolor referido en escala de ${datos.evaFinal}/10`);

                nota += signosFinales.join(', ') + `. `;
            }

            // Observaciones adicionales
            if (datos.observaciones && datos.observaciones.toLowerCase() !== 'ninguna' && datos.observaciones.toLowerCase() !== 'ninguno') {
                nota += `Observaciones adicionales: ${datos.observaciones}. `;
            }

            // Estado general y cierre
            if (esInestable) {
                nota += `El paciente presenta inestabilidad hemodin√°mica durante el turno. `;
                const justificacionEstabilidad = evaluarEstabilidadHemodinamica();
                if (justificacionEstabilidad) {
                    nota += `Motivo(s): ${justificacionEstabilidad}. `;
                }
            } else {
                nota += `El paciente se encuentra estable hemodin√°micamente, sin presentar complicaciones durante el turno. `;
            }

            nota += `Se entrega para continuidad de cuidados al siguiente turno.\n\n`;

            // Firma
            nota += `_________________________________\n`;
            nota += `Enfermero(a) de turno\n`;
            nota += `Fecha y hora: ${fecha} - ${hora}`;

            return nota;
        }


        let esInestable = false; // Variable global

        function evaluarEstabilidadHemodinamica() {
            const pam = parseFloat(document.getElementById('pamFinalValue')?.textContent || 0);
            const fc = parseFloat(document.getElementById('fcFinal')?.value || 0);
            const spo2 = parseFloat(document.getElementById('spo2Final')?.value || 0);
            const sistolica = parseFloat(document.getElementById('paSistolicaFinal')?.value || 0);
            const temperatura = parseFloat(document.getElementById('temperaturaFinal')?.value || 0);

            esInestable = false; // Reinicia el estado
            let justificaciones = [];

            if (pam < 60) {
                esInestable = true;
                justificaciones.push("PAM menor a 60 mmHg");
            }

            if (fc > 100) {
                esInestable = true;
                justificaciones.push("taquicardia (FC mayor a 100 lpm)");
            } else if (fc < 50) {
                esInestable = true;
                justificaciones.push("bradicardia (FC menor a 50 lpm)");
            }

            if (spo2 < 90) {
                esInestable = true;
                justificaciones.push("hipoxia (SpO2 menor al 90%)");
            }

            if (sistolica < 90) {
                esInestable = true;
                justificaciones.push("hipotensi√≥n (Presi√≥n Sist√≥lica menor a 90 mmHg)");
            }

            if (temperatura && (temperatura < 35 || temperatura > 39)) {
                esInestable = true;
                justificaciones.push(`temperatura anormal (${temperatura}¬∞C)`);
            }

            return justificaciones.join(", ");
        }

        // Funciones mostrar Sugerencias
        function mostrarSugerenciasEnPantalla() {
            const datos = recopilarDatos();
            const sugerencias = [];

            // Temperatura
            if (datos.temperaturaFinal >= 38) {
                sugerencias.push("üå°Ô∏è Temperatura elevada. Posible fiebre.");
            } else if (datos.temperaturaFinal <= 35) {
                sugerencias.push("‚ùÑÔ∏è Hipotermia. Revisar condiciones del paciente.");
            }

            // Presi√≥n arterial media
            if (datos.pamFinal < 60) {
                sugerencias.push("‚ö†Ô∏è PAM final baja. Posible hipotensi√≥n.");
            }

            // FC
            if (datos.fcFinal >= 100) {
                sugerencias.push("üíì Taquicardia. Frecuencia card√≠aca elevada.");
            } else if (datos.fcFinal < 60) {
                sugerencias.push("ü´Ä Bradicardia. Frecuencia card√≠aca baja.");
            }

            // FR
            if (datos.frFinal >= 24) {
                sugerencias.push("üå¨Ô∏è Taquipnea. Frecuencia respiratoria elevada.");
            } else if (datos.frFinal < 12) {
                sugerencias.push("üòÆ‚Äçüí® Bradipnea. FR disminuida.");
            }

            // SpO2
            if (datos.spo2Final < 90) {
                sugerencias.push("ü©∏ Saturaci√≥n cr√≠tica (<90%).");
            } else if (datos.spo2Final < 94) {
                sugerencias.push("ü©π Saturaci√≥n ligeramente baja (<94%).");
            }

            // PA sist√≥lica
            if (datos.paSistolicaFinal < 90) {
                sugerencias.push("üìâ PA sist√≥lica baja (<90 mmHg).");
            } else if (datos.paSistolicaFinal > 140) {
                sugerencias.push("üìà PA sist√≥lica elevada (>140 mmHg).");
            }

            // PA diast√≥lica
            if (datos.paDiastolicaFinal < 60) {
                sugerencias.push("üìâ PA diast√≥lica baja (<60 mmHg).");
            } else if (datos.paDiastolicaFinal > 90) {
                sugerencias.push("üìà PA diast√≥lica elevada (>90 mmHg).");
            }

            // EVA
            if (datos.evaFinal >= 7) {
                sugerencias.push("‚ö†Ô∏è Dolor severo (EVA ‚â• 7). Evaluar analgesia.");
            } else if (datos.evaFinal >= 4) {
                sugerencias.push("‚ö†Ô∏è Dolor moderado (EVA ‚â• 4). Valorar intervenci√≥n.");
            }

            // Mostrar en pantalla
            const divInfo = document.getElementById("sugerenciasInfo");
            const lista = document.getElementById("sugerenciasLista");
            lista.innerHTML = "";

            if (sugerencias.length > 0) {
                sugerencias.forEach(msg => {
                    const li = document.createElement("li");
                    li.textContent = msg;
                    lista.appendChild(li);
                });
                divInfo.classList.remove("hidden");
            } else {
                divInfo.classList.add("hidden");
            }
        }



        // Funciones para la nota generada
        function copiarNota() {
            const nota = document.getElementById('notaGenerada').textContent;
            navigator.clipboard.writeText(nota).then(() => {
                alert('Nota copiada al portapapeles');
            }).catch(() => {
                alert('Error al copiar la nota');
            });
        }

        function descargarNota() {
            const nota = document.getElementById('notaGenerada').textContent;
            const iniciales = document.getElementById('iniciales').value || 'Paciente';
            const fecha = new Date().toISOString().split('T')[0];
            const filename = `Nota_Enfermeria_${iniciales}_${fecha}.txt`;

            const blob = new Blob([nota], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        window.siguienteSeccion = function () {
            if (currentSection < 4) {
                showSection(currentSection + 1);
            }
        };

        window.toggleAccesoVenoso = function () {
            const checkbox = document.getElementById('tieneAccesoVenoso');
            const fields = document.getElementById('accesoVenosoFields');

            if (checkbox.checked) {
                fields.classList.remove('hidden');
            } else {
                fields.classList.add('hidden');
            }
        };

        async function exportarComoPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const texto = document.getElementById('notaGenerada').textContent;

            const lineas = doc.splitTextToSize(texto, 180);
            doc.text(lineas, 15, 20);
            const nombre = document.getElementById('iniciales').value || 'Paciente';
            const fecha = new Date().toISOString().split('T')[0];
            doc.save(`Nota_Enfermeria_${nombre}_${fecha}.pdf`);
        }

        window.addEventListener('scroll', () => {
            const btn = document.getElementById('scrollTopBtn');
            if (window.scrollY > 300) {
                btn.classList.remove('hidden');
            } else {
                btn.classList.add('hidden');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.tooltip-trigger').forEach(element => {
                element.addEventListener('click', (e) => {
                    const tooltipText = e.target.getAttribute('data-tooltip');
                    let tooltip = e.target.nextElementSibling;

                    if (!tooltip || !tooltip.classList.contains('tooltip')) {
                        tooltip = document.createElement('div');
                        tooltip.className = 'tooltip';
                        tooltip.textContent = tooltipText;
                        e.target.parentNode.appendChild(tooltip);
                    }

                    if (tooltip.classList.contains('hidden')) {
                        tooltip.classList.remove('hidden');
                    } else {
                        tooltip.classList.add('hidden');
                    }
                });
            });
        });
        document.addEventListener('click', (e) => {
            if (!e.target.classList.contains('tooltip-trigger')) {
                document.querySelectorAll('.tooltip').forEach(tooltip => tooltip.classList.add('hidden'));
            }
        });

        function inicializarTooltips() {
            document.querySelectorAll('.tooltip-trigger').forEach(element => {
                element.addEventListener('click', (e) => {
                    const tooltipText = e.target.getAttribute('data-tooltip');
                    let tooltip = e.target.nextElementSibling;

                    if (!tooltip || !tooltip.classList.contains('tooltip')) {
                        tooltip = document.createElement('div');
                        tooltip.className = 'tooltip';
                        tooltip.textContent = tooltipText;
                        e.target.parentNode.appendChild(tooltip);
                    }

                    if (tooltip.classList.contains('hidden')) {
                        tooltip.classList.remove('hidden');
                    } else {
                        tooltip.classList.add('hidden');
                    }
                });
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
            inicializarTooltips();
        });

        // CONTROL DE LIQUIDOS
        function toggleControlLiquidos() {
            const controlLiquidosCheckbox = document.getElementById('realizarControlLiquidos');
            const controlLiquidosFields = document.getElementById('controlLiquidosFields');

            if (controlLiquidosCheckbox.checked) {
                controlLiquidosFields.classList.remove('hidden');
            } else {
                controlLiquidosFields.classList.add('hidden');
            }
        }

        // A√±adir el evento de c√°lculo autom√°tico
        document.getElementById('liquidosAdministrados').addEventListener('input', calcularBalanceHidrico);
        document.getElementById('liquidosEliminados').addEventListener('input', calcularBalanceHidrico);

        function calcularBalanceHidrico() {
            const administradosInput = document.getElementById('liquidosAdministrados');
            const eliminadosInput = document.getElementById('liquidosEliminados');
            const balanceField = document.getElementById('balanceHidrico');

            // Forzar valores no negativos
            let liquidosAdministrados = parseFloat(administradosInput.value) || 0;
            let liquidosEliminados = parseFloat(eliminadosInput.value) || 0;

            if (liquidosAdministrados < 0) {
                liquidosAdministrados = 0;
                administradosInput.value = 0;
                alert("Los l√≠quidos administrados no pueden ser negativos. Valor corregido a 0.");
            }

            if (liquidosEliminados < 0) {
                liquidosEliminados = 0;
                eliminadosInput.value = 0;
                alert("Los l√≠quidos eliminados no pueden ser negativos. Valor corregido a 0.");
            }

            // Calcular balance
            const balance = liquidosAdministrados - liquidosEliminados;
            balanceField.value = balance.toFixed(2); // Mostrar con 2 decimales

            // Aplicar color al campo del balance h√≠drico
            if (balance < 0) {
                balanceField.style.borderColor = "#EF4444"; // Rojo
                balanceField.style.color = "#EF4444";
            } else {
                balanceField.style.borderColor = "#10B981"; // Verde
                balanceField.style.color = "#10B981";
            }
        }

        // Vincular eventos a los campos de l√≠quidos
        document.getElementById('liquidosAdministrados').addEventListener('input', calcularBalanceHidrico);
        document.getElementById('liquidosEliminados').addEventListener('input', calcularBalanceHidrico);

        // IMC
        function toggleIMC() {
            const seccion = document.getElementById("seccionIMC");
            const check = document.getElementById("mostrarIMC");
            if (check.checked) {
                seccion.classList.remove("hidden");
            } else {
                seccion.classList.add("hidden");
                document.getElementById("resultadoIMC").textContent = "";
            }
        }

        function calcularIMC() {
            const peso = parseFloat(document.getElementById("peso").value);
            const talla = parseFloat(document.getElementById("talla").value) / 100;

            if (!peso || !talla || talla <= 0) {
                alert("Por favor, ingresa un peso y una talla v√°lidos.");
                return;
            }

            const imc = peso / (talla * talla);
            let estado = "";

            if (imc < 18.5) estado = "Bajo peso";
            else if (imc < 24.9) estado = "Normal";
            else if (imc < 29.9) estado = "Sobrepeso";
            else estado = "Obesidad";

            document.getElementById("resultadoIMC").textContent = `IMC: ${imc.toFixed(2)} (${estado})`;
        }

        // exportarXLSX
        async function exportarComoXLSXBonito() {
            const datos = recopilarDatos();
            const workbook = new ExcelJS.Workbook();

            const now = new Date();
            const fechaStr = now.toLocaleDateString();
            const horaStr = now.toLocaleTimeString();
            const nombre = datos.iniciales || "Paciente";

            // üü¶ HOJA 1: RESUMEN GENERAL
            const hoja1 = workbook.addWorksheet("Resumen del Paciente");

            hoja1.mergeCells("A1", "B1");
            hoja1.getCell("A1").value = "Nota de Enfermer√≠a";
            hoja1.getCell("A1").font = { size: 16, bold: true };
            hoja1.getCell("A1").alignment = { horizontal: "center" };

            const resumen = [
                ["Fecha", fechaStr],
                ["Hora", horaStr],
                ["Iniciales", datos.iniciales],
                ["Edad", datos.edad],
                ["G√©nero", datos.genero],
                ["Habitaci√≥n", datos.habitacion],
                ["Diagn√≥stico Principal", datos.diagnosticoPrincipal],
                ["Acompa√±ante", datos.acompanante],
                ["Escala de Glasgow", datos.glasgow],
                ["Posici√≥n", datos.posicion],
                ["Acceso Venoso", datos.tieneAccesoVenoso ? "S√≠" : "No"],
                ["Ubicaci√≥n Acceso", datos.ubicacionAcceso],
                ["Calibre", datos.calibreCateter],
                ["Tipo de dieta", datos.tipoDieta],
                ["Restricciones", datos.restricciones],
                ["Antecedentes", datos.antecedentes],
                ["Evaluaci√≥n Nutricional", datos.evaluacionNutricional],
                ["Observaciones", datos.observaciones],
                ["Balance H√≠drico", datos.realizarControlLiquidos ? `${datos.balanceHidrico} mL` : "No se realiz√≥"],
            ];

            resumen.forEach(([campo, valor]) => hoja1.addRow([campo, valor]));

            hoja1.columns = [
                { width: 30 },
                { width: 50 }
            ];

            hoja1.eachRow((row, i) => {
                if (i === 1) return;
                row.getCell(1).font = { bold: true };
                row.eachCell(cell => {
                    cell.border = {
                        top: { style: "thin" },
                        bottom: { style: "thin" },
                        left: { style: "thin" },
                        right: { style: "thin" }
                    };
                    cell.alignment = { vertical: "middle" };
                });
            });

            // üü© HOJA 2: SIGNOS VITALES
            const hoja2 = workbook.addWorksheet("Signos Vitales");

            hoja2.addRow(["Signo", "Ingreso", "Entrega"]).font = { bold: true };
            hoja2.addRows([
                ["FC", datos.fc, datos.fcFinal],
                ["FR", datos.fr, datos.frFinal],
                ["Temperatura", datos.temperatura, datos.temperaturaFinal],
                ["SpO2", datos.spo2, datos.spo2Final],
                ["PA Sist√≥lica", datos.paSistolica, datos.paSistolicaFinal],
                ["PA Diast√≥lica", datos.paDiastolica, datos.paDiastolicaFinal],
                ["Glucometr√≠a", datos.glucometria, datos.glucometriaFinal],
                ["EVA", datos.eva, datos.evaFinal]
            ]);

            hoja2.columns = [
                { width: 25 },
                { width: 15 },
                { width: 15 }
            ];

            hoja2.eachRow(row => {
                row.eachCell(cell => {
                    cell.border = {
                        top: { style: "thin" },
                        bottom: { style: "thin" },
                        left: { style: "thin" },
                        right: { style: "thin" }
                    };
                });
            });

            // üü® HOJA 3: MEDICAMENTOS
            const hoja3 = workbook.addWorksheet("Medicamentos");
            hoja3.addRow(["Nombre", "Dosis", "V√≠a", "Hora", "Observaciones"]).font = { bold: true };

            datos.medicamentos.forEach(med => {
                hoja3.addRow([
                    med.nombre,
                    med.dosis,
                    med.via,
                    med.hora,
                    med.observaciones
                ]);
            });

            hoja3.columns = [
                { width: 25 },
                { width: 15 },
                { width: 15 },
                { width: 12 },
                { width: 40 }
            ];

            // üü• HOJA 4: EVENTOS
            const hoja4 = workbook.addWorksheet("Eventos del Turno");
            hoja4.addRow(["Hora", "Tipo", "Descripci√≥n"]).font = { bold: true };

            datos.eventos.forEach(ev => {
                hoja4.addRow([
                    ev.hora,
                    ev.tipo,
                    ev.descripcion
                ]);
            });

            hoja4.columns = [
                { width: 12 },
                { width: 25 },
                { width: 60 }
            ];

            // üì• EXPORTACI√ìN
            const buffer = await workbook.xlsx.writeBuffer();
            const blob = new Blob([buffer], {
                type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
            });

            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Nota_Enfermeria_${nombre}_${now.toISOString().split("T")[0]}.xlsx`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }



        // ATAJOS

        document.addEventListener('keydown', function (e) {
            if (!e.altKey) return;

            switch (e.key) {
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                    showSection(parseInt(e.key) - 1);
                    break;
                case 'm':
                case 'M':
                    e.preventDefault();
                    if (document.getElementById('section-2').classList.contains('section-active')) {
                        agregarMedicamento();
                    }
                    break;
                case 'e':
                case 'E':
                    e.preventDefault();
                    if (document.getElementById('section-3').classList.contains('section-active')) {
                        agregarEvento();
                    }
                    break;
                case 'g':
                case 'G':
                    e.preventDefault();
                    if (currentSection === 3) {
                        generarNota();
                    }
                    break;
            }
        });


        // Validaci√≥n para evitar ir a la secci√≥n 4 sin datos m√≠nimos
        function showSection(sectionIndex) {
            if (sectionIndex === 4) {
                const campos = ['iniciales', 'edad', 'habitacion'];
                let faltantes = [];

                campos.forEach(id => {
                    const campo = document.getElementById(id);
                    campo.classList.remove('input-error'); // limpia errores previos

                    if (!campo.value.trim()) {
                        campo.classList.add('input-error');
                        faltantes.push(id);
                    }
                });

                if (faltantes.length > 0) {
                    alert("Por favor completa los campos m√≠nimos requeridos antes de continuar:\n- Iniciales\n- Edad\n- Habitaci√≥n");
                    return;
                }
            }


            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
                section.classList.remove('section-active');
            });

            // Mostrar la secci√≥n seleccionada
            const selectedSection = document.getElementById(`section-${sectionIndex}`);
            selectedSection.classList.remove('hidden');
            selectedSection.classList.add('section-active', 'fade-in');

            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-button').forEach((btn, index) => {
                btn.classList.remove('active');
                if (index === sectionIndex) {
                    btn.classList.add('active');
                }
            });

            // Actualizar progreso
            currentSection = sectionIndex;
            updateNavigationButtons();
            actualizarBarraProgreso();
        }

        // Dictado por voz (para eventos y  tos)
        function iniciarDictadoEnTextarea(boton) {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'es-ES';

            recognition.onresult = function (event) {
                const transcript = event.results[0][0].transcript;
                const textarea = boton.previousElementSibling;
                if (textarea && textarea.tagName === "TEXTAREA") {
                    textarea.value += (textarea.value ? '\n' : '') + transcript;
                }
            };

            recognition.start();
        }


    </script>

</body>

</html>
